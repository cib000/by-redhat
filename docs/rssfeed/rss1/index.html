<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>뉴스 모아보기</title>
  <style>
    body { 
	  font-family: Arial, sans-serif; 
      width: 95vw;
	  height: 70vh;
	  background-image: url('bg.webp');
	  background-repeat: no-repeat;
	  background-attachment: fixed;
	  background-size: cover;
	}
    #loading { color: gray; }
    li { margin-bottom: 6px; }
	header {
	  position: fixed;
	  top: 0;
	  /* width: 100% */
	  left: 0;
	  right: 0;
	  height: 120px;
	  padding: 1rem;
	  color: white;
	  background: teal;
	  font-weight: bold;
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  margin-bottom: 30px;
	}
	section {
	 margin-top: 100px;
	 overflow-x: hidden;
	 overflow-y: auto;
	 margin-left: 20px;
	 padding-left: 40px;
	 height:400px; 
	 border: 1px solid red;
	 border-radius: 10px;
	 font-size: 1.2em;
	}
	footer {
	  background-image: url('simple-bg-a.png');
	  background-repeat: no-repeat;
	  margin-top: 30px;
	  padding: 30px;
	  border: 1px solid blue;
	  border-radius: 20px;
	}
	summary {
	  cursor: pointer;
	}
    .date {
      font-size: 0.8em;
      color: #666;
      margin-left: 6px;
    }
	.author {
	  font-size: 0.8em;
	  color: #999;
	  margin-left: 4px;
	}
  </style>

</head>
<body>

  <header>
	<h1>뉴스 모아보기 (사용자 파일)</h1>
	<img src="rss_news1.png" width="250px">
	
	<div>
		<h2>RSS 선택</h2>

		<!-- 기본값 포함 콤보 -->
		<select id="rssSelect">
		  <option value="https://windowsforum.kr/free/rss" selected>윈도우 포럼</option>
		</select>
		
		<!-- 텍스트 파일 선택 버튼 -->
		<label>RSS 목록 불러오기 (.txt): </label>
		<input type="file" id="fileInput" accept=".txt">

		<p>
		선택한 RSS 주소:<br>
		<span id="rssResult" style="color:blue;"></span>
		</p>

	</div>
	
  </header>	
<br><br>

  <section>
<!--   <h2>RSS 선택</h2>  -->


<p id="loading" style="display:none;">불러오는 중...</p>

<ul id="rss-feed"></ul>


  </section>

  <footer>
	<div>
		<details>
		<summary> 사용자 파일 규칙과 추가방법 및 도움말 </summary>
		<ul>
		<li>추가규칙 : </li>
		<li>예제 : 사이트 A,https://example.com/rss1.xml</li>
		<li>구문의 순서와 구분 : 이름,주소 [ 구분자는 쉽표 , 입니다.] - 줄바꿈</li>
		
		

		<p>RSS 주소가 궁금하시지요? 크롬 확장앱을 사용해 보세요. 추천</p>
		<a href="https://chromewebstore.google.com/detail/get-rss-feed-url/kfghpdldaipanmkhfpdcjglncmilendn"
		target="blank" title="크롬 웹스토어 확장앱">
		<img src="rss_logo.png"> Get RSS Feed URL </a>
		</ul>
		</details>		
	</div>
  </footer>


<script>
const rssSelect = document.getElementById("rssSelect");
const fileInput = document.getElementById("fileInput");
const rssResult = document.getElementById("rssResult");
const rssFeed = document.getElementById("rss-feed");
const loadingText = document.getElementById("loading");

// ===============================
// 1️⃣ 파일에서 RSS 목록 불러오기
// ===============================
fileInput.addEventListener("change", function() {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const text = e.target.result;
    const lines = text.split("\n");

    lines.forEach(line => {
      const [name, url] = line.split(",");
      if (name && url) {
        const option = document.createElement("option");
        option.value = url.trim();
        option.textContent = name.trim();
        rssSelect.appendChild(option);
      }
    });

    // 파일 불러온 후에도 기존 선택 유지 또는 기본값 적용
    loadRSS(rssSelect.value);
  };
  reader.readAsText(file);
});

// ===============================
// 2️⃣ 콤보 선택 이벤트
// ===============================
rssSelect.addEventListener("change", function() {
  loadRSS(this.value);
});

// ===============================
// 3️⃣ RSS 로드 및 표시
// ===============================
function loadRSS(rssUrl) {
  rssFeed.innerHTML = "";
  rssResult.textContent = "";

  if (!rssUrl) return;

  rssResult.textContent = rssUrl;
  loadingText.style.display = "block";

  fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(rssUrl))
    .then(response => response.text())
    .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
    .then(data => {
      const items = data.querySelectorAll("item");

      items.forEach(item => {
        const title = item.querySelector("title") ? item.querySelector("title").textContent : "제목 없음";
        const link = item.querySelector("link") ? item.querySelector("link").textContent : "#";
        const pubDate = item.querySelector("pubDate") ? item.querySelector("pubDate").textContent : "";
        const author = item.querySelector("author") ? item.querySelector("author").textContent : "";

        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = link;
        a.textContent = title;
        a.target = "_blank";
        a.rel = "noopener noreferrer";

        li.appendChild(a);

        if (pubDate) {
          const dateSpan = document.createElement("span");
          dateSpan.className = "date";
          dateSpan.textContent = "(" + new Date(pubDate).toLocaleDateString() + ")";
          li.appendChild(dateSpan);
        }

        if (author) {
          const authorSpan = document.createElement("span");
          authorSpan.className = "author";
          authorSpan.textContent = " by " + author;
          li.appendChild(authorSpan);
        }

        rssFeed.appendChild(li);
      });
    })
    .catch(error => {
      console.error(error);
      rssFeed.innerHTML = "<li>RSS를 불러오지 못했습니다.</li>";
    })
    .finally(() => {
      loadingText.style.display = "none";
    });
}

// ===============================
// 4️⃣ 페이지 로드 시 기본값 RSS 자동 로드
// ===============================
window.addEventListener("load", function() {
  loadRSS(rssSelect.value);
});


</script>

</body>
</html>
