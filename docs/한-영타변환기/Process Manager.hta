<html>
<head>
<HTA:APPLICATION ID="프로세서 관리 도우미" ICON="Process Manager1.ico" MAXIMIZEBUTTON="yes" border="yes" BORDERSTYLE="normal" CAPTION="yes" showInTaskbar="yes" innerBorder="yes" scroll="no" singleInstance="yes" selection="no" version="1.0" />

<title>프로세서 관리 도우미</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<style>
#processTable {
	font-family: arial, sans-serif;
	font-size: 10pt;
	border-collapse: collapse;
	width: 100%;
}

#processTable td, th {
	border: 1px solid #dddddd;
	text-align: left;
	padding: 3px;
}
</style>

<script language="JavaScript">
	// More info about GetObject("WinMgmts:").InstancesOf("Win32_Process"), see: https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-process
	
	var searchString = ""
	
	function clearSearchProcess(){
		searchString = ""
		document.getElementById("searchProcessName").value = "";
		getSysRunningProccesses();
	}
	
	function teminateProcess(processId, processName){
		if (confirm('프로세스를 종료하시겠습니까? 대상프로세스 : \n"' + processName + '" ?')) {
			var WshShell = new ActiveXObject("WScript.Shell");
			var oExec = WshShell.Run("taskkill /F /PID " + processId, 0, true);
			//var oExec = WshShell.Exec("taskkill /f /pid " + processId);
			getSysRunningProccesses()
		}
	}

	function getProcessListAndDisplayInHTML()
	{
		searchString = document.getElementById("searchProcessName").value;
		
		var procs = GetObject("WinMgmts:").InstancesOf("Win32_Process");
		var tableRowsHTML = "";
		var i = 1
		procEnum = new Enumerator(procs);
	  
		for ( ; !procEnum.atEnd(); procEnum.moveNext())
		{
			var proc = procEnum.item();
			
			var isShow = false;
			
			if (searchString != "") {
				if (proc.Name.toLowerCase().indexOf(searchString.toLowerCase()) != -1
					|| proc.Description.toLowerCase().indexOf(searchString.toLowerCase()) != -1) {
					isShow = true;
				}
			} else {
				isShow = true;
			}
			if (isShow) {
				tableRowsHTML += 	'<tr><td>' + i.toString()
										+ '</td><td>' + proc.Name
										+ '</td><td>' + proc.ProcessID 
										+ '</td><td>' + proc.ParentProcessID
										+ '</td><td>' + proc.Status							
										+ '</td><td>' + proc.Description
										+ '</td><td>' + proc.ThreadCount							
										+ '</td><td style="width:200px"><button onclick=\'teminateProcess('
										+ proc.ProcessID.toString() + ', "' + proc.Name + '")\'>종료하기</button></td></tr>\n';
			}
			i++;
		}
		
		var htmlTable = '<table id="processTable" style="position: absolute;">'
						+ '<tr>'
						+ '	<th>번호.</th>'
						+ '	<th>프로세스 이름</th>'
						+ '	<th>프로세스 ID</th>'
						+ '	<th>상위 프로세스 ID</th>'
						+ '	<th>상태</th>'
						+ '	<th>설명</th>'
						+ '	<th>스레드 수</th>'
						+ '	<th>사용자 종료</th>'
						+ '</tr>'
						+ tableRowsHTML + '</table>'
		
		return htmlTable;
	}

	function getSysRunningProccesses()
	{
		var oOutput = document.getElementById("processTableDisplay");
		oOutput.innerHTML = "";
		oOutput.innerHTML = getProcessListAndDisplayInHTML();
	}

	window.onload = function() {
		getSysRunningProccesses()
	}
	refreshInterval = setInterval(getSysRunningProccesses, 2000);
</script>
</head>

<body bgcolor="#7DCCBD"> 

	<input id="searchProcessName" type="text" onClick="this.select();"></input> &nbsp;&nbsp;&nbsp;
	<button onclick="clearSearchProcess()" style="background-color:blue; color:#fff; ">입력 비우기</button>
	<span style="color:#0000ff; font-size:18px; font-weight:950; ">프로세스 목록 갱신 자동 : 2초 </span>
	<br/><br/>
    <div style="height:90%; overflow:auto; width:100%" id="processTableDisplay"></div>

</body>
</html>